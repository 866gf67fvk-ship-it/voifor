<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOIFOR -声占い-</title>
    <meta name="theme-color" content="#667eea">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="style.css?v=12">
</head>
<body>
    <!-- メイン画面 -->
    <div id="mainScreen" class="screen active">
        <div class="container">
            
            <!-- タイトル -->
            <header class="app-header">
                <h1>VOIFOR</h1>
                <p>-声占い-</p>
            </header>

<!-- キャラ＆カレンダーエリア -->
            <div class="main-info-row">
<!-- 左：キャラ画像（タップで選択画面へ） -->
                <div class="character-area" onclick="showCharacterSelect()">
                    <div id="characterImage" class="character-image"></div>
                </div>
<!-- 右：カレンダー（上）＋プロフ（下） -->
                <div class="right-column">
                    <div class="calendar-area" onclick="openCalendarModal()">
                        <div id="calendarDisplay" class="mini-calendar"></div>
                    </div>
                    <div class="user-stats">
                        <span>🔥 <span id="streakCount">0</span>日連続</span>
                        <span>📊 <span id="totalCount">0</span>回</span>
                    </div>
                </div>
            </div>
            <!-- キャラの言葉/占い結果 -->
            <div class="speech-bubble" id="speechBubble">
                占いの準備ができました！
            </div>
            <!-- 今日の占いボタン -->
            <button class="main-fortune-btn" onclick="startVoiceFortune()">
                🔮 今日の占い！
            </button>

            <!-- チケット＆設定エリア -->
            <div class="action-row">
                <div class="ticket-info" onclick="showPurchaseScreen()">
                    <span>🎫 チケット</span>
                    <span id="ticketCount">0</span>
                </div>
                <div class="side-buttons">
                    <button onclick="showSettingsScreen()">⚙️ 設定</button>
                    <button onclick="showHistoryScreen()">📜 履歴</button>
                </div>
            </div>

            <!-- 動画＆招待エリア -->
            <div class="action-row">
                <button class="ad-btn" onclick="watchAdForTicket()">
                    📺 動画みて+1
                </button>
                <button class="invite-btn" onclick="showReferralScreen()">
                    👥 招待
                </button>
            </div>

            <!-- その他占い -->
            <div class="other-fortune-section">
                <h2>その他占い</h2>
                <div class="fortune-grid">
                    <button class="fortune-card" onclick="showCompatibilityScreen()">
                        💕 相性占い
                    </button>
                    <button class="fortune-card" onclick="showTarotScreen()">
                        🃏 タロット占い
                    </button>
                    <button class="fortune-card" onclick="showDreamScreen()">
                        🌙 夢占い
                    </button>
                    <button class="fortune-card coming-soon" disabled>
                        🔜 Coming soon...
                    </button>
                </div>
            </div>

        </div>
    </div>

<!-- キャラ選択画面 -->
    <div id="characterSelectScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1>キャラ選択</h1>
                <p>占い師を選んでね</p>
            </header>
            
            <div class="grid-with-back">
                <button class="grid-back-btn" onclick="goBack()">←</button>
                <div class="character-grid" id="characterGrid">
                    <!-- JSで生成 -->
                </div>
            </div>
        </div>
    </div>
<!-- 占い画面 -->
    <div id="fortuneScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <button class="header-back-btn" onclick="goBack()">←</button>
                <h1>🔮 今日の占い</h1>
            </header>
            
            <!-- キャラ画像 -->
            <div class="fortune-char-area">
                <div id="fortuneCharImage" class="fortune-char-image"></div>
                <p id="fortuneCharSpeech" class="fortune-char-speech">3秒間、声を聞かせて！</p>
            </div>
            
            <!-- 録音エリア -->
            <div id="recordingArea">
                <button id="recordBtn" class="record-btn" onclick="startRecording()">🎤 録音開始</button>
                <div id="voiceMeter" class="voice-meter" style="display: none;">
                    <div id="voiceLevel" class="voice-level"></div>
                </div>
                <p id="countdown" class="countdown"></p>
            </div>
            
            <!-- 占い中表示 -->
            <div id="fortuneLoading" class="fortune-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p id="loadingText">占い中...</p>
            </div>
            
            <!-- 占い結果 -->
            <div id="fortuneResult" style="display: none;">
                <div class="result-card">
                    <div id="fortuneText" class="fortune-text"></div>
                </div>
                <div class="lucky-info">
                    <div class="lucky-item">🍀 <span id="luckyItem"></span></div>
                    <div class="lucky-item">🎨 <span id="luckyColor"></span></div>
                    <div class="lucky-item">🔢 <span id="luckyNumber"></span></div>
                </div>
                <button class="record-btn" onclick="retryFortune()">🔮 もう一度占う</button>
            </div>
        </div>
 </div>

    <!-- カレンダーモーダル -->
    <div id="calendarModal" class="modal" onclick="closeCalendarModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalMonthTitle">2025年11月</h2>
                <button class="modal-close" onclick="closeCalendarModal()">&times;</button>
            </div>
            <div id="modalCalendarGrid" class="modal-calendar-grid"></div>
            <div id="modalHistoryArea" class="modal-history">
                <p class="history-placeholder">日付をタップして履歴を見る</p>
            </div>
        </div>
     </div>


<!-- 設定画面 -->
    <div id="settingsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <button class="header-back-btn" onclick="goBack()">←</button>
                <h1>⚙️ 設定</h1>
            </header>
            
            <div class="settings-menu">
                <button class="settings-btn" onclick="showCharacterSelect()">
                    <span class="settings-icon">🎭</span>
                    <span class="settings-text">キャラクター変更</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn" onclick="showEditScreen()">
                    <span class="settings-icon">✏️</span>
                    <span class="settings-text">プロフィール編集</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn" onclick="showPurchaseScreen()">
                    <span class="settings-icon">🎫</span>
                    <span class="settings-text">チケット購入</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn danger" onclick="confirmReset()">
                    <span class="settings-icon">🗑️</span>
                    <span class="settings-text">データリセット</span>
                    <span class="settings-arrow">→</span>
                </button>
            </div>
            
            <div class="app-info">
                <p>VOIFOR -声占い- v1.0</p>
                <p>© 2025 VOIFOR</p>
            </div>
        </div>
    </div>

<!-- プロフィール編集画面 -->
    <div id="editScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.8em;">✏️ プロフィール</h1>
            </header>
            
            <div class="edit-form">
                <button class="form-back-btn" onclick="goBack()">← 戻る</button>
                <div class="form-group">
                    <label>ニックネーム</label>
                    <input type="text" id="editNickname" placeholder="ニックネームを入力">
                </div>
                
                <div class="form-group">
                    <label>生年月日</label>
                    <input type="date" id="editBirthday">
                </div>
                
                <div class="form-group">
                    <label>性別</label>
                    <select id="editGender">
                        <option value="">選択してください</option>
                        <option value="male">男性</option>
                        <option value="female">女性</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                
                <button class="save-btn" onclick="saveProfile()">✅ 保存する</button>
            </div>
        </div>
    </div>
  
<!-- 履歴画面 -->
    <div id="historyScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <button class="header-back-btn" onclick="goBack()">←</button>
                <h1>📜 占い履歴</h1>
            </header>
            
            <div class="history-tabs">
                <button class="history-tab active" onclick="filterHistory('all')" id="tabAll">📚 すべて</button>
                <button class="history-tab" onclick="filterHistory('voice')" id="tabVoice">🎤 声占い</button>
                <button class="history-tab" onclick="filterHistory('tarot')" id="tabTarot">🃏 タロット</button>
                <button class="history-tab" onclick="filterHistory('compatibility')" id="tabCompat">💕 相性</button>
            </div>
            
            <div id="historyList" class="history-list">
                <!-- JSで生成 -->
            </div>
        </div>
    </div>   

<!-- 購入画面 -->
    <div id="purchaseScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.6em;">🎫 チケット購入</h1>
                <p>現在: <span id="currentTickets">0</span>枚</p>
            </header>
            
<button class="form-back-btn" onclick="goBack()">← 戻る</button>
            <div class="purchase-options">
                <div class="purchase-card" onclick="purchaseTickets(1, 100)">
                    <div class="ticket-amount">🎫 1回分</div>
                    <div class="ticket-price">¥100</div>
                    <div class="ticket-unit">お試し</div>
                </div>
                
                <div class="purchase-card" onclick="purchaseTickets(10, 200)">
                    <div class="ticket-amount">🎫 10回分</div>
                    <div class="ticket-price">¥200</div>
                    <div class="ticket-unit">¥20/回</div>
                </div>
                
                <div class="purchase-card" onclick="purchaseTickets(25, 500)">
                    <div class="ticket-amount">🎫 25回分</div>
                    <div class="ticket-price">¥500</div>
                    <div class="ticket-unit">¥20/回</div>
                </div>
                
                <div class="purchase-card popular" onclick="purchaseTickets(30, 500)">
                    <div class="popular-badge">人気!</div>
                    <div class="ticket-amount">🎫 30回分</div>
                    <div class="ticket-price">¥500</div>
                    <div class="ticket-unit">¥16.7/回</div>
                </div>
            </div>
            
<h2 style="text-align: center; margin: 20px 0 15px;">👑 プレミアムプラン</h2>
            <div class="purchase-card premium" onclick="purchasePremium()">
                <div class="ticket-amount">占い放題（1日20回）</div>
                <div class="ticket-price">¥1,480/月</div>
                <div class="ticket-unit">広告なし</div>
            </div>
            
            <div class="free-ticket-section">
                <h2>🎁 無料でチケット獲得</h2>
                <button class="free-ticket-btn video" onclick="watchAdForTicket()">
                    📺 動画を見て1チケット獲得
                </button>
                <button class="free-ticket-btn referral" onclick="showReferralScreen()">
                    👥 友達紹介で1チケット獲得
                </button>
                <button class="free-ticket-btn sns" onclick="shareToSNS()">
                    📱 SNS投稿で1チケット獲得
                </button>
            </div>
        </div>
    </div>

    <script src="supabase-config.js"></script>
<script src="app.js?v=5"></script>

</body>
</html>