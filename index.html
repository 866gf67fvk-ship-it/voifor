<!DOCTYPE html4
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOIFOR -声占い-</title>
    <meta name="theme-color" content="#667eea">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="style.css?v=135">
</head>
<body>
<!-- 初回登録画面 -->
    <div id="registrationScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1>VOIFOR</h1>
                <p>-声占い-</p>
            </header>
            
            <div class="registration-form">
                <p class="welcome-text">
                    ✨ ようこそ！<br>
                    あなたのことを教えてください
                </p>
                
<div class="input-group">
                    <label>お名前</label>
                    <input type="text" id="regName" placeholder="ニックネームでOK">
                </div>
                
                <div class="input-group">
                    <label>生年月日</label>
                    <input type="date" id="regBirth" min="1900-01-01" max="2025-12-31">
                </div>
                
                <div class="input-group">
                    <label>血液型</label>
                    <select id="regBloodType">
                        <option value="">選択してください</option>
                        <option value="A">A型</option>
                        <option value="B">B型</option>
                        <option value="O">O型</option>
                        <option value="AB">AB型</option>
                    </select>
                </div>
                
                <!-- 紹介コード入力欄 -->
                <div class="referral-input-box">
                    <div class="referral-label">🎁 紹介コードをお持ちですか？</div>
                    <input type="text" id="referralCodeInput" placeholder="紹介コード（任意）">
                    <div class="referral-hint">✨ 入力すると、あなたと紹介者にボーナス！</div>
                </div>
                
                <button class="register-btn" onclick="completeRegistration()">
                    占いを始める ✨
                </button>
            </div>
        </div>
    </div>

    <!-- メイン画面 -->
    <div id="mainScreen" class="screen active">
        <div class="container">
            
            <!-- タイトル -->
            <header class="app-header">
                <h1>VOIFOR</h1>
                <p>-声占い-</p>
            </header>

<!-- キャラ＆カレンダーエリア -->
            <div class="main-info-row">
<!-- 左：キャラ画像（タップで選択画面へ） -->
                <div class="character-area" onclick="showCharacterSelect()">
                    <div id="characterImage" class="character-image"></div>
                </div>
<!-- 右：カレンダー（上）＋プロフ（下） -->
                <div class="right-column">
                    <div class="calendar-area" onclick="openCalendarModal()">
                        <div id="calendarDisplay" class="mini-calendar"></div>
                    </div>
<div class="user-stats" onclick="showSettingsScreen()">
    <div class="profile-line">
        <span id="userEto"></span>
        <span id="userBlood"></span>
        <span class="profile-sep">|</span>
        <span id="userBirth"></span>
        <span id="userZodiac"></span>
    </div>
    <div class="profile-line">
        <span>🔥<span id="streakCount">0</span></span>
        <span class="profile-sep">|</span>
        <span>📊<span id="totalCount">0</span></span>
    </div>
</div>
                </div>
            </div>
            <!-- キャラの言葉/占い結果 -->
            <div class="speech-bubble" id="speechBubble">
                占いの準備ができました！
            </div>
            <!-- 今日の占いボタン -->
            <button class="main-fortune-btn" onclick="startVoiceFortune()">
                🔮  今日の声占い  🔮
            </button>

            <!-- チケット＆設定エリア -->
            <div class="action-row">
<div class="ticket-info" onclick="showPurchaseScreen()">
    <span class="ticket-free">🎫 <span id="freeTicketCount">3</span></span>
    <span class="ticket-divider">|</span>
    <span class="ticket-earned">⭐ <span id="earnedTicketCount">0</span></span>
</div>

                <div class="side-buttons">
                    <button onclick="showSettingsScreen()">⚙️ 設定</button>
                    <button onclick="showHistoryScreen()">📜 履歴</button>
                </div>
            </div>

            <!-- 動画＆招待エリア -->
            <div class="action-row">
                <button class="ad-btn" onclick="watchAdForTicket()">
                    📺 動画みて+1
                </button>
                <button class="invite-btn" onclick="showReferralScreen()">
                    👥 招待
                </button>
            </div>

            <!-- その他占い -->
            <div class="other-fortune-section">
                <h2>その他占い</h2>
                <div class="fortune-grid">
                    <button class="fortune-card" onclick="showCompatibilityScreen()">
                        💕 相性占い
                    </button>
                    <button class="fortune-card" onclick="showTarotScreen()">
                        🃏 タロット占い
                    </button>
                    <button class="fortune-card" onclick="showDreamScreen()">
                        🌙 夢占い
                    </button>
                    <button class="fortune-card coming-soon" disabled>
                        🔜 Coming soon...
                    </button>
                </div>
            </div>

        </div>
    </div>

<!-- キャラ選択画面 -->
    <div id="characterSelectScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1>キャラ選択</h1>
                <p>占い師を選んでね</p>
            </header>
            
            <button class="section-back-btn" onclick="goBack()">← 戻る</button>
            
            <div class="character-grid" id="characterGrid">
                <!-- JSで生成 -->
            </div>
        </div>
    </div>
<!-- 占い画面 -->
    <div id="fortuneScreen" class="screen">
        <div class="container">
<header class="app-header">
                <h1>🔮 今日の占い</h1>
            </header>
            
<!-- キャラ画像 -->
            <div class="fortune-char-area">
                <button class="fortune-back-btn" onclick="goBack()">←</button>
                <div id="fortuneCharImage" class="fortune-char-image"></div>
                <p id="fortuneCharSpeech" class="fortune-char-speech">3秒間、声を聞かせて！</p>
            </div>
            
            <!-- 録音エリア -->
            <div id="recordingArea">
                <button id="recordBtn" class="record-btn" onclick="startRecording()">🎤 録音開始</button>
                <div id="voiceMeter" class="voice-meter" style="display: none;">
                    <div id="voiceLevel" class="voice-level"></div>
                </div>
                <p id="countdown" class="countdown"></p>
            </div>
            
            <!-- 占い中表示 -->
            <div id="fortuneLoading" class="fortune-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p id="loadingText">占い中...</p>
            </div>
            
            <!-- 占い結果 -->
            <div id="fortuneResult" style="display: none;">
                <div class="result-card">
                    <div id="fortuneText" class="fortune-text"></div>
                </div>
                <div class="lucky-info">
                    <div class="lucky-item">🍀 <span id="luckyItem"></span></div>
                    <div class="lucky-item">🎨 <span id="luckyColor"></span></div>
                    <div class="lucky-item">🔢 <span id="luckyNumber"></span></div>
                </div>
<div class="result-buttons">
                    <button class="record-btn" onclick="retryFortune()">🔮 もう一度占う</button>
                    <button class="back-btn" onclick="goBack()">← 戻る</button>
                </div>
            </div>
        </div>
 </div>

    <!-- カレンダーモーダル -->
    <div id="calendarModal" class="modal" onclick="closeCalendarModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
<div class="modal-header">
    <button class="nav-btn" onclick="changeMonth(-1)">◀</button>
    <h2 id="modalMonthTitle">2025年12月</h2>
    <button class="nav-btn" onclick="changeMonth(1)">▶</button>
    <button class="modal-close" onclick="closeCalendarModal()">&times;</button>
</div>
            <div id="modalCalendarGrid" class="modal-calendar-grid"></div>
            <div id="modalHistoryArea" class="modal-history">
                <p class="history-placeholder">日付をタップして履歴を見る</p>
            </div>
        </div>
     </div>


<!-- 設定画面 -->
    <div id="settingsScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <button class="header-back-btn" onclick="goBack()">←</button>
                <h1>⚙️ 設定</h1>
            </header>
            
            <div class="settings-menu">
                <button class="settings-btn" onclick="showCharacterSelect()">
                    <span class="settings-icon">🎭</span>
                    <span class="settings-text">キャラクター変更</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn" onclick="showEditScreen()">
                    <span class="settings-icon">✏️</span>
                    <span class="settings-text">プロフィール編集</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn" onclick="showPurchaseScreen()">
                    <span class="settings-icon">🎫</span>
                    <span class="settings-text">チケット購入</span>
                    <span class="settings-arrow">→</span>
                </button>
                
                <button class="settings-btn danger" onclick="confirmReset()">
                    <span class="settings-icon">🗑️</span>
                    <span class="settings-text">データリセット</span>
                    <span class="settings-arrow">→</span>
                </button>
            </div>
            
            <div class="app-info">
                <p>VOIFOR -声占い- v1.0</p>
                <p>© 2025 VOIFOR</p>
            </div>
        </div>
    </div>

<!-- プロフィール編集画面 -->
    <div id="editScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.8em;">✏️ プロフィール</h1>
            </header>
            
            <button class="form-back-btn" onclick="goBack()">← 戻る</button>
            
            <div class="edit-form">
                <div class="form-group">
                    <label>ニックネーム</label>
                    <input type="text" id="editNickname" placeholder="ニックネームを入力">
                </div>
                
                <div class="form-group">
                    <label>生年月日</label>
                    <input type="date" id="editBirthday">
                </div>
                
                <div class="form-group">
                    <label>性別</label>
                    <select id="editGender">
                        <option value="">選択してください</option>
                        <option value="male">男性</option>
                        <option value="female">女性</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                
                <button class="save-btn" onclick="saveProfile()">✅ 保存する</button>
            </div>
        </div>
    </div>
  
<!-- 履歴画面 -->
    <div id="historyScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1>📜 占い履歴</h1>
            </header>
            
            <button class="section-back-btn" onclick="goBack()">← 戻る</button>
            
<div class="history-layout">
                <div class="history-sidebar">
                    <button class="history-tab active" id="tabAll" onclick="filterHistory('all')">すべて</button>
                    <button class="history-tab" id="tabVoice" onclick="filterHistory('voice')">🎤 声占い</button>
                    <button class="history-tab" id="tabTarot" onclick="filterHistory('tarot')">🃏 タロット</button>
                    <button class="history-tab" id="tabCompat" onclick="filterHistory('compatibility')">💕 相性</button>
                    <button class="history-tab" id="tabDream" onclick="filterHistory('dream')">🌙 夢占い</button>
                </div>
                <div id="historyList" class="history-list">
                    <!-- JSで生成 -->
                </div>
            </div>
        </div>
    </div>   

<!-- タロット占い画面 -->
    <div id="tarotScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.8em;">🃏 タロット占い</h1>
            </header>
                        
            <!-- Step1: 枚数選択 -->
            <div id="tarotStep1">
                <h3 class="step-title">カードを何枚引きますか？</h3>
                <div class="spread-cards">
                    <div class="spread-card" onclick="selectSpread(1)">
                        <div class="spread-card-icon">🃏</div>
                        <div class="spread-card-title">1枚引き</div>
                        <div class="spread-card-desc">シンプルに今の状況を占う</div>
                        <div class="spread-card-cost">🎫 1チケット</div>
                    </div>
<div class="spread-card" onclick="selectSpread(3)">
                        <div class="spread-card-icon">🃏🃏🃏</div>
                        <div class="spread-card-title">3枚引き</div>
                        <div class="spread-card-desc">過去・現在・未来を占う</div>
                        <div class="spread-card-cost">🎫 2チケット</div>
                    </div>
                </div>
                <button class="compat-back-btn" onclick="goBack()">← 戻る</button>
            </div>
            
            <!-- Step2: 質問入力 -->
            <div id="tarotStep2" style="display: none;">
                <h3 class="step-title">質問方法を選んでください</h3>
                <div class="category-grid">
                    <button class="category-btn" onclick="selectTarotCategory('恋愛')">💕 恋愛</button>
                    <button class="category-btn" onclick="selectTarotCategory('仕事')">💼 仕事</button>
                    <button class="category-btn" onclick="selectTarotCategory('金運')">💰 金運</button>
                    <button class="category-btn" onclick="selectTarotCategory('人間関係')">👥 人間関係</button>
                    <button class="category-btn" onclick="selectTarotCategory('健康')">🏥 健康</button>
                    <button class="category-btn" onclick="selectTarotCategory('全般')">✨ 全般</button>
                </div>
<div class="voice-option">
                    <button class="voice-category-btn" onclick="startTarotVoiceQuestion()">🎤 声で質問する</button>
                </div>
                <button class="compat-back-btn" onclick="backToTarotStep1()">← 戻る</button>
            </div>          
            <!-- Step3: カード選択 -->
            <div id="tarotStep3" style="display: none;">
                <h3 class="step-title">カードを<span id="cardCount">1</span>枚選んでください</h3>
                <p class="selected-info">選んだ枚数: <span id="selectedCount">0</span> / <span id="maxCards">1</span></p>
                <div class="tarot-cards" id="tarotCards"></div>
<button class="submit-btn" id="revealBtn" onclick="revealCards()" disabled>カードをめくる</button>
                <button class="compat-back-btn" id="tarotStep3BackBtn" onclick="confirmTarotStep3Back()">← 戻る</button>
            </div>
            <!-- ローディング -->
            <div id="tarotLoading" style="display: none;">
                <div class="loading-spinner"></div>
                <p id="tarotLoadingText">カードが語りかけています...</p>
            </div>
            
            <!-- 結果表示 -->
            <div id="tarotResult" style="display: none;">
                <div class="tarot-result-cards" id="resultCards"></div>
                <div class="result-card">
                    <div id="tarotFortuneText" class="fortune-text"></div>
                </div>
<div class="result-buttons">
                    <button class="submit-btn" onclick="retryTarot()">🃏 もう一度占う</button>
                    <button class="back-btn" onclick="goBack()">← 戻る</button>
                </div>
            </div>
        </div>
    </div>
<!-- 相性占い画面 -->
    <div id="compatibilityScreen" class="screen">
        <div class="container">
 <header class="app-header">
                <h1 style="font-size: 1.8em;">💕 相性占い</h1>
                <p>2人の情報で相性を占います</p>
<p style="font-size: 0.85em; opacity: 0.8;">※名前 + (生年月日・血液型・性別・音声)のうち最低1つ入力</p>
   <p class="screen-ticket">🎫 1チケット（声録音する場合は1人1枚）</p>
            </header>
                        
<!-- Step1: 人物1の情報 -->
            <div id="compatStep1">
                <h3 class="step-title">👤 人物1の情報</h3>
                <div class="compat-form">
                    <div class="form-group">
                        <label>名前 <span style="color: #ff6b6b;">*必須</span></label>
                        <input type="text" id="compat1Name" placeholder="例：太郎">
                    </div>
<div class="form-group">
                        <label>生年月日（任意・星座＆干支も計算！）</label>
                        <div class="birthday-row">
                            <input type="date" id="compat1Birthday" onchange="showZodiacAndEto(1)">
                            <span id="compat1Zodiac" class="zodiac-display"></span>
                            <span id="compat1Eto" class="zodiac-display"></span>
                        </div>
                    </div>
<div class="form-group">
                        <label>血液型（任意）</label>
                        <select id="compat1Blood">
                            <option value="">選択してください</option>
                            <option value="A">A型</option>
                            <option value="B">B型</option>
                            <option value="O">O型</option>
                            <option value="AB">AB型</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>性別（任意）</label>
                        <select id="compat1Gender">
                            <option value="">選択してください</option>
                            <option value="male">男性</option>
                            <option value="female">女性</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
<label>音声で占う（任意・なんでもOK！）</label>
                        <button class="voice-record-btn" id="compat1VoiceBtn" onclick="recordCompatVoice(1)">🎤 録音する</button>
                        <p id="compat1VoiceStatus" class="voice-status"></p>
                    </div>
<button class="submit-btn" onclick="goToCompatStep2()">次へ →</button>
                    <button class="compat-back-btn" onclick="confirmCompatStep1Back()">← 戻る</button>
                </div>
            </div>
            
<!-- Step2: 人物2の情報 -->
            <div id="compatStep2" style="display: none;">
                <h3 class="step-title">👤 人物2の情報</h3>
                <div class="compat-form">
                    <div class="form-group">
                        <label>名前 <span style="color: #ff6b6b;">*必須</span></label>
                        <input type="text" id="compat2Name" placeholder="例：花子">
                    </div>
<div class="form-group">
                        <label>生年月日（任意・星座＆干支も計算！）</label>
                        <div class="birthday-row">
                            <input type="date" id="compat2Birthday" onchange="showZodiacAndEto(2)">
                            <span id="compat2Zodiac" class="zodiac-display"></span>
                            <span id="compat2Eto" class="zodiac-display"></span>
                        </div>
                    </div>
<div class="form-group">
                        <label>血液型（任意）</label>
                        <select id="compat2Blood">
                            <option value="">選択してください</option>
                            <option value="A">A型</option>
                            <option value="B">B型</option>
                            <option value="O">O型</option>
                            <option value="AB">AB型</option>
                        </select>
                    </div>
<div class="form-group">
                        <label>性別（任意）</label>
                        <select id="compat2Gender">
                            <option value="">選択してください</option>
                            <option value="male">男性</option>
                            <option value="female">女性</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>二人の関係</label>
<select id="compatRelation">
                            <option value="">選択してください</option>
                            <option value="crush">片思い中</option>
                            <option value="dating">交際中</option>
                            <option value="friend">友人</option>
                            <option value="coworker">同僚・仕事仲間</option>
                            <option value="ex">元恋人</option>
                            <option value="family">家族</option>
                            <option value="oshi">推し・ファン</option>
                            <option value="celebrity">有名人・芸能人</option>
                            <option value="idol">憧れの人</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>音声で占う（任意・なんでもOK！）</label>
<button class="voice-record-btn" id="compat2VoiceBtn" onclick="recordCompatVoice(2)">🎤 録音する</button>
                        <p id="compat2VoiceStatus" class="voice-status"></p>
                    </div>
<button class="submit-btn" onclick="startCompatibilityFortune()">💕 相性を占う</button>
                    <button class="compat-back-btn" id="compatStep2BackBtn" onclick="confirmCompatStep2Back()">← 戻る</button>
                </div>
            </div>
            
            <!-- ローディング -->
            <div id="compatLoading" style="display: none;">
                <div class="fortune-loading">
                    <div class="loading-spinner"></div>
                    <p>相性を占っています...</p>
                </div>
            </div>
            
            <!-- 結果 -->
            <div id="compatResult" style="display: none;">
                <div class="compat-score">
                    <div class="score-circle" id="compatScoreCircle">
                        <span id="compatScore">??</span>%
                    </div>
                </div>
                <div class="result-card">
                    <div id="compatFortuneText" class="fortune-text"></div>
                </div>
<div class="result-buttons">
                    <button class="submit-btn" onclick="retryCompatibility()">💕 もう一度占う</button>
                    <button class="back-btn" onclick="goBack()">← 戻る</button>
                </div>
            </div>
        </div>
    </div>
    
<!-- 夢占い画面 -->
    <div id="dreamScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.8em;">🌙 夢占い</h1>
                <p>見た夢の内容を教えてください</p>
            </header>
            
            <!-- Step1: 占い方法選択 -->
            <div id="dreamStep1">
                <h3 class="step-title">どう占いますか？</h3>
                <div class="spread-cards">
                    <div class="spread-card" onclick="selectDreamType('simple')">
                        <div class="spread-card-icon">🌙</div>
                        <div class="spread-card-title">シンプルに占う</div>
                        <div class="spread-card-desc">夢の内容のみで占います</div>
                        <div class="spread-card-cost">🎫 1チケット</div>
                    </div>
<div class="spread-card" onclick="selectDreamType('detailed')">
                        <div class="spread-card-icon">✨</div>
                        <div class="spread-card-title">詳しく占う</div>
                        <div class="spread-card-desc">詳細情報も含めて深く分析</div>
                        <div class="spread-card-cost">🎫 2チケット</div>
                    </div>
                </div>
                <button class="compat-back-btn" onclick="goBack()">← 戻る</button>
            </div>
            
            <!-- Step2: 入力方法選択 -->
            <div id="dreamStep2" style="display: none;">
                <h3 class="step-title">夢の内容をどう伝えますか？</h3>
                <div class="category-grid">
                    <button class="category-btn" onclick="selectDreamInput('text')">📝 テキストで書く</button>
                    <button class="category-btn" onclick="selectDreamInput('voice')">🎤 声で話す</button>
                </div>
                
                <!-- テキスト入力 -->
<div id="dreamTextInput" style="display: none;">
                    <textarea id="dreamText" class="dream-textarea" placeholder="例：空を飛んでいて、友達と一緒に雲の上を歩いていました..."></textarea>
                    <button class="submit-btn" onclick="submitDreamContent()">次へ →</button>
                    <button class="compat-back-btn" onclick="backToDreamStep1()">← 戻る</button>
                </div>
                
                <!-- 音声入力 -->
<div id="dreamVoiceInput" style="display: none;">
                    <p style="text-align: center; opacity: 0.8; margin: 15px 0;">夢の内容を話してください（最大15秒）</p>
                    <button class="voice-record-btn" id="dreamVoiceBtn" onclick="recordDreamVoice()">🎤 録音する</button>
                    <p id="dreamVoiceStatus" class="voice-status"></p>
                    <button class="submit-btn" id="dreamVoiceNext" onclick="submitDreamContent()" style="display: none;">次へ →</button>
                    <button class="compat-back-btn" onclick="backToDreamStep1()">← 戻る</button>
                </div>
            </div>
            <!-- Step3: 詳細情報（詳しく占う の場合のみ） -->
            <div id="dreamStep3" style="display: none;">
                <h3 class="step-title">詳細情報を入力してください</h3>
                <div class="dream-details-form">
                    <div class="form-group">
                        <label>いつ見た夢ですか？</label>
                        <select id="dreamWhen">
                            <option value="">選択してください</option>
                            <option value="今朝">今朝</option>
                            <option value="昨夜">昨夜</option>
                            <option value="数日前">数日前</option>
                            <option value="繰り返し見る夢">繰り返し見る夢</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>夢の中の感情は？</label>
                        <select id="dreamEmotion">
                            <option value="">選択してください</option>
                            <option value="楽しい">😊 楽しい</option>
                            <option value="怖い">😨 怖い</option>
                            <option value="悲しい">😢 悲しい</option>
                            <option value="不安">😰 不安</option>
                            <option value="穏やか">😌 穏やか</option>
                            <option value="その他">🤔 その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>印象的だったシーン・人物・物は？（任意）</label>
                        <input type="text" id="dreamImpression" placeholder="例：青い海、母親、白い犬など">
                    </div>
                    <div class="form-group">
                        <label>夢の色彩は？</label>
                        <select id="dreamColor">
                            <option value="">選択してください</option>
                            <option value="カラー">🌈 カラー</option>
                            <option value="白黒">⬛ 白黒</option>
                            <option value="覚えていない">❓ 覚えていない</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>目覚めた時の気分は？</label>
                        <select id="dreamWakeup">
                            <option value="">選択してください</option>
                            <option value="スッキリ">😃 スッキリ</option>
                            <option value="モヤモヤ">😕 モヤモヤ</option>
                            <option value="怖かった">😱 怖かった</option>
                            <option value="幸せ">🥰 幸せ</option>
                            <option value="その他">🤷 その他</option>
                        </select>
                    </div>
<button class="submit-btn" onclick="submitDreamFortune()">🌙 夢を占う</button>
                    <button class="compat-back-btn" onclick="backToDreamStep2()">← 戻る</button>
                </div>
            </div>
            
            <!-- ローディング -->
            <div id="dreamLoading" style="display: none;">
                <div class="fortune-loading">
                    <div class="loading-spinner"></div>
                    <p>夢を分析しています...</p>
                </div>
            </div>
            
            <!-- 結果 -->
            <div id="dreamResult" style="display: none;">
                <div class="dream-symbol">
                    <span id="dreamSymbolIcon">🌙</span>
                </div>
                <div class="result-card">
                    <div id="dreamFortuneText" class="fortune-text"></div>
                </div>
<div class="result-buttons">
                    <button class="submit-btn" onclick="retryDream()">🌙 もう一度占う</button>
                    <button class="back-btn" onclick="goBack()">← 戻る</button>
                </div>
            </div>
        </div>
    </div>
    
<!-- 購入画面 -->
    <div id="purchaseScreen" class="screen">
        <div class="container">
            <header class="app-header">
                <h1 style="font-size: 1.6em;">🎫 チケット購入</h1>
                <p>現在: <span id="currentTickets">0</span>枚</p>
            </header>
            
<button class="form-back-btn" onclick="goBack()">← 戻る</button>
            <div class="purchase-options">
                <div class="purchase-card" onclick="purchaseTickets(1, 100)">
                    <div class="ticket-amount">🎫 1回分</div>
                    <div class="ticket-price">¥100</div>
                    <div class="ticket-unit">お試し</div>
                </div>
                
                <div class="purchase-card" onclick="purchaseTickets(10, 200)">
                    <div class="ticket-amount">🎫 10回分</div>
                    <div class="ticket-price">¥200</div>
                    <div class="ticket-unit">¥20/回</div>
                </div>
                
                <div class="purchase-card" onclick="purchaseTickets(25, 500)">
                    <div class="ticket-amount">🎫 25回分</div>
                    <div class="ticket-price">¥500</div>
                    <div class="ticket-unit">¥20/回</div>
                </div>
                
                <div class="purchase-card popular" onclick="purchaseTickets(30, 500)">
                    <div class="popular-badge">人気!</div>
                    <div class="ticket-amount">🎫 30回分</div>
                    <div class="ticket-price">¥500</div>
                    <div class="ticket-unit">¥16.7/回</div>
                </div>
            </div>
            
<h2 style="text-align: center; margin: 20px 0 15px;">👑 プレミアムプラン</h2>
            <div class="purchase-card premium" onclick="purchasePremium()">
                <div class="ticket-amount">占い放題（1日20回）</div>
                <div class="ticket-price">¥1,480/月</div>
                <div class="ticket-unit">広告なし</div>
            </div>
            
            <div class="free-ticket-section">
                <h2>🎁 無料でチケット獲得</h2>
                <button class="free-ticket-btn video" onclick="watchAdForTicket()">
                    📺 動画を見て1チケット獲得
                </button>
                <button class="free-ticket-btn referral" onclick="showReferralScreen()">
                    👥 友達紹介で1チケット獲得
                </button>
                <button class="free-ticket-btn sns" onclick="shareToSNS()">
                    📱 SNS投稿で1チケット獲得
                </button>
            </div>
        </div>
    </div>

    <script src="supabase-config.js"></script>
<script src="app.js?v=135"></script>

</body>
</html>